<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="bcvtb_modelica" default="build" xmlns:cpptasks="antlib:net.sf.antcontrib.cpptasks">
  <import file="../../build-common.xml"/>

  <!-- Clean -->
  <target name="clean" description="Deletes generated files">
    <delete verbose="true">
      <fileset dir="." includes="*.obj,*.o,*.so,*.lib,*.dll,*.exp,*.manifest"/>
    </delete>
  </target>

  <!-- Compile -->
  <target name="compile" if="have.dymola" description="Compiles the source">
    <cpptasks:cc runtime="static" objdir=".">
      <cpptasks:compiler name="${cc}"/>
      <compilerarg value="${cc.compile}"/>
      <fileset dir="." includes="*.c"/>
      <includepath path="../util"/>
    </cpptasks:cc>
  </target>

  <!-- Link -->
  <target name="link" if="have.dymola" depends="compile" description="Links the binaries">
    <cpptasks:cc runtime="static" outtype="shared" outfile="bcvtb_modelica">
      <cpptasks:linker name="${cc}"/>
      <linkerarg value="${cc.link}"/>
      <linkerarg value="bcvtb.${extObj}"/>
      <libset    dir=  "../util" libs="bcvtb"/>

      <linkerarg value="/EXPORT:establishBSDSocket"           if="windows"/>
      <linkerarg value="/EXPORT:closeBSDSocket"               if="windows"/>
      <linkerarg value="/EXPORT:exchangeDoublesWithBSDSocket" if="windows"/>
 <!--  
      <linkerarg value="/EXPORT:sendclienterror"       if="windows"/>
      <linkerarg value="/EXPORT:getnumberofxmlvalues"  if="windows"/>
-->
    </cpptasks:cc>
  </target>


  <!-- Build -->
  <target name="build" if="have.dymola" depends="link" description="Builds the libraries"/>

  <!-- All -->
  <target name="all" if="have.dymola" depends="build" description="Runs all targets"/>

  <!-- Distribute libraries needed for Dymola -->
  <target name="distDymola" if="have.dymola" depends="all"
          description="Distributes libraries needed for Dymola">
     <copy file="bcvtb.h"                        todir="${path.dymola.work}"/>
     <copy file="bcvtb_modelica.dll"             todir="${path.dymola.work}"/>
     <copy file="bcvtb_modelica.lib"             todir="${path.dymola.work}"/>
     <copy file="${path.expat}/bin/libexpat.dll" todir="${path.dymola.work}"/>
     <copy file="..${file.separator}util${file.separator}bcvtb.dll"
           todir="${path.dymola.work}"/>
     <copy file="..${file.separator}util${file.separator}bcvtb.lib"
           todir="${path.dymola.work}"/>

  </target>


</project>
