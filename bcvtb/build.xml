<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="bcvtb" default="all"> 
<import file="build-common.xml"/>

  <!-- Clean -->
  <target name="clean" description="Deletes generated files">
    <ant dir="lib"         target="clean"/>
    <ant dir="doc"         target="clean"/>
    <ant dir="examples"    target="clean"/>
    <delete dir=".">
      <include name="**/history.xml"/>
      <include name="**/dependencies.xml"/>
      <include name="**/simulation.log"/>
      <include name="**/simulation.log"/>
    </delete>
  </target>

  <!-- All -->
  <target name="all" description="Runs all targets">
    <!-- Update build information -->
    <propertyfile file="buildinfo.properties"
		  comment="Build Information File - DO NOT CHANGE">
      <entry key="build.num"
	     type="int" default="0000"
	     operation="+" pattern="0000"/>
      <entry key="build.date"
	     type="date"
	     value="now"
	     pattern="yyyy-dd-MM HH:mm"/>
    </propertyfile>

    <ant dir="lib"       target="all"/>
    <ant dir="examples"  target="all"/>
  </target>
  
  <!-- Unit tests -->
  <target name="unitTest" description="Runs unit tests">
    <ant dir="examples"             target="unitTest"/>
  </target>
  
  <!-- Generates doxygen code documentation -->
  <target name="doc" description="Generates the code documentation">
    <ant dir="doc"   target="doc"/>
  </target>

  <!-- Copies the jar files from the Ptolemy development to the BCVTB -->
  <target name="updatePtolemyFiles" depends="cleanPtolemyFiles"
          description="Copies the Ptolemy files to the BCVTB">
     <copy file="${env.BCVTB_PTIISrc}/copyright.txt"                   todir="lib/ptII/"/>
     <copy file="${env.BCVTB_PTIISrc}/doc/docConfig.jar"               todir="lib/ptII/doc/"/>
     <copy file="${env.BCVTB_PTIISrc}/doc/codeDoc.jar"                 todir="lib/ptII/doc/"/>

     <copy file="${env.BCVTB_PTIISrc}/lib/diva.jar"                    todir="lib/ptII/lib/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/ptsupport.jar"           todir="lib/ptII/ptolemy/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/vergil/vergil.jar"       todir="lib/ptII/ptolemy/vergil/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/domains/sdf/sdf.jar"     todir="lib/ptII/ptolemy/domains/sdf/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/domains/modal/modal.jar" todir="lib/ptII/ptolemy/domains/modal/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/domains/fsm/fsm.jar"     todir="lib/ptII/ptolemy/domains/fsm/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/domains/ct/ct.jar"       todir="lib/ptII/ptolemy/domains/ct/"/>
     <copy file="${env.BCVTB_PTIISrc}/ptolemy/domains/domains.jar"     todir="lib/ptII/ptolemy/domains/"/>

     <copy todir="lib/ptII/ptolemy/configs">
       <fileset dir="${env.BCVTB_PTIISrc}/ptolemy/configs" excludes="**/*.svn,makefile"/>
     </copy>

     <copy todir="lib/ptII/ptolemy/actor/lib/database/">
       <fileset dir="${env.BCVTB_PTIISrc}/ptolemy/actor/lib/database" excludes="**/*.svn,makefile"/>
     </copy>


     <copy todir="lib/ptII/lbnl">
       <fileset dir="${env.BCVTB_PTIISrc}/lbnl" excludes="**/*.svn,makefile"/>
     </copy>
<!-- vergil has path hardwired. We don't use it here
     <copy todir="lib/ptII/bin">
       <fileset dir="${env.BCVTB_PTIISrc}/bin" excludes="makefile"/>
     </copy>
-->
 <!-- copy pdf documentation -->
 <copy todir="lib/ptII/doc/design/" flatten="true">
    <resources>
      <url url="http://www.eecs.berkeley.edu/Pubs/TechRpts/2008/EECS-2008-28.pdf"/>
      <url url="http://www.eecs.berkeley.edu/Pubs/TechRpts/2008/EECS-2008-29.pdf"/>
      <url url="http://www.eecs.berkeley.edu/Pubs/TechRpts/2008/EECS-2008-37.pdf"/>
    </resources>
  </copy>
  <move file="lib/ptII/doc/design/EECS-2008-28.pdf" 
      tofile="lib/ptII/doc/design/ptIIdesign1-intro.pdf"/>
  <move file="lib/ptII/doc/design/EECS-2008-29.pdf"  
      tofile="lib/ptII/doc/design/ptIIdesign2-software.pdf"/>
  <move file="lib/ptII/doc/design/EECS-2008-37.pdf" 
      tofile="lib/ptII/doc/design/ptIIdesign3-domains.pdf"/>

      <!-- Insert bcvtb version info -->
      <replace file="lib/ptII/ptolemy/configs/bcvtb/intro.htm"> 
        <replacetoken><![CDATA[<h1>Building Controls Virtual Test Bed (BCVTB) Edition</h1>]]></replacetoken>
        <replacevalue><![CDATA[<h1>BCVTB Edition, Version MYVERSION</h1>]]>
	</replacevalue>
      </replace>
      <replace file="lib/ptII/ptolemy/configs/bcvtb/intro.htm" token="MYVERSION" value="${VERSION}"/> 

      <!-- Update copyright link -->
      <replace file="lib/ptII/ptolemy/configs/bcvtb/intro.htm"> 
        <replacetoken><![CDATA[<li><a href="about:copyright" target="_blank">Copyright</a></li>]]></replacetoken>
        <replacevalue><![CDATA[
<li><a href="about:copyright" target="_blank">Copyright Ptolemy</a></li>
<li><a href="../../../../../legal.html" target="_blank">Copyright BCVTB</a></li>
]]></replacevalue>
</replace>

      <!-- Replace example list so that it points to BCVTB example list -->
      <replace file="lib/ptII/ptolemy/configs/bcvtb/intro.htm"> 
        <replacetoken><![CDATA[<h2>Demonstrations</h2>
<ul>
  <li> <a href="../../../lbnl/demo/CRoom/CRoom.xml">C Room</a> - a simple interface to a small C program.
  <li> <a href="../../../lbnl/demo/MatlabRoom/MatlabRoom.xml">Matlab Room</a> - a simple interface to a small Matlab program. (<i>Matlab required</i>)
</ul>]]></replacetoken>
	  <replacevalue><![CDATA[
<h2>Demonstrations</h2>
<b>Note:</b> Some demonstrations require to be started from dos or bash. Otherwise, files with relative
path names may not be found.
<h3>Windows</h3>
<ul>
<li> <a href="../../../../../examples/dymola-room/system-windows.xml">dymola-room</a>:
Dymola simple room model, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/dymolaSimulink-room/system-windows.xml">dymolaSimulink-room</a>:
Dymola simple room model, controls simulated by Simulink.
<li> <a href="../../../../../examples/ePlus31-simple/system-windows.xml">ePlus31-simple</a>:
EnergyPlus building and HVAC system, setpoint simulated by Ptolemy.
<li> <a href="../../../../../examples/ePlus31Ptolemy-vav/system-windows.xml">ePlus31Ptolemy-vav</a>:
EnergyPlus building, variable air volume flow system simulated by Ptolemy.
<li> <a href="../../../../../examples/ePlus31Simulink-simple/system-windows.xml">ePlus31Simulink-simple</a>:
EnergyPlus building and HVAC system, setpoint simulated by Simulink.
<li> <a href="../../../../../examples/matlab-room/system.xml">matlab-room</a>:
Matlab simple room model, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/simulink-room/system.xml">simulink-room</a>:
Simulink controller, simple room model simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/system.xml">ptolemy-room</a>:
Room model, simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/systemFSM.xml">ptolemy-room</a>:
Room model with finite state machine, simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/systemVisual.xml">ptolemy-room</a>:
Room model with icon color changing based on room temperature, simulated by Ptolemy.
<li> <a href="../../../../../examples/c-room/system-windows.xml">c-room</a>:
Room model simulated in C, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/c-timeSync/system-windows.xml">c-timeSync</a>:
Two programs implemented in C that exchange their data.
<li> <a href="../../../../../examples/f90-room/system-windows.xml">f90-room</a>:
Room model simulated in F90, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/www-weather/system.xml">www-weather</a>:
Example that gets minimum and maximum outside temperature from Berkeley weather forecast.

</ul>
<h3>Mac OS X and Linux</h3>
<ul>
<li> <a href="../../../../../examples/ePlus31-simple/system.xml">ePlus31-simple</a>:
EnergyPlus building and HVAC system, setpoint simulated by Ptolemy.
<li> <a href="../../../../../examples/ePlus31Ptolemy-vav/system.xml">ePlus31Ptolemy-vav</a>:
EnergyPlus building, variable air volume flow system simulated by Ptolemy.
<li> <a href="../../../../../examples/ePlus31Simulink-simple/system.xml">ePlus31Simulink-simple</a>:
EnergyPlus building and HVAC system, setpoint simulated by Simulink.
<li> <a href="../../../../../examples/matlab-room/system.xml">matlab-room</a>:
Matlab simple room model, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/simulink-room/system.xml">simulink-room</a>:
Simulink controller, simple room model simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/system.xml">ptolemy-room</a>:
Room model, simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/systemFSM.xml">ptolemy-room</a>:
Room model with finite state machine, simulated by Ptolemy.
<li> <a href="../../../../../examples/ptolemy-room/systemVisual.xml">ptolemy-room</a>:
Room model with icon color changing based on room temperature, simulated by Ptolemy.
<li> <a href="../../../../../examples/c-room/system.xml">c-room</a>:
Room model simulated in C, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/c-timeSync/system.xml">c-timeSync</a>:
Two programs implemented in C that exchange their data.
<li> <a href="../../../../../examples/f90-room/system.xml">f90-room</a>:
Room model simulated in F90, controls simulated by Ptolemy.
<li> <a href="../../../../../examples/www-weather/system.xml">www-weather</a>:
Example that gets minimum and maximum outside temperature from Berkeley weather forecast.
</ul>
	  ]]></replacevalue>
      </replace>

  </target>

  <!-- Deletes the Ptolemy files -->
  <target name="cleanPtolemyFiles" description="Deletes the Ptolemy files of the BCVTB">
    <delete verbose="true" dir="lib/ptII"/>
  </target>

  <!-- Builds distribution file -->
  <target name="dist" description="Builds all the distribution files">
    <ant dir="install" target="dist"/>
  </target>

  <target name="dist-bcvtb" description="Builds the distribution files for the bcvtb only">
    <ant dir="install" target="dist-bcvtb"/>
  </target>
  <target name="dist-EnergyPlus" description="Builds the distribution files for EnergyPlus only">
    <ant dir="install" target="dist-EnergyPlus"/>
  </target>

</project>
